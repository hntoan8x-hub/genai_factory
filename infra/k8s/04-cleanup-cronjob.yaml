# Tri·ªÉn khai D·ªçn d·∫πp (Governance CronJob)
# ----------------------------------------------------
# üîπ CRONJOB: Artifact Cleanup (Role: ETL)
# ----------------------------------------------------
apiVersion: batch/v1
kind: CronJob
metadata:
  name: artifact-cleanup-job
spec:
  # Ch·∫°y h√†ng ng√†y l√∫c 01:00 s√°ng UTC (ƒë·∫£m b·∫£o ngo√†i gi·ªù cao ƒëi·ªÉm)
  schedule: "0 1 * * *"
  successfulJobsHistoryLimit: 3 # Gi·ªØ 3 l·ªãch s·ª≠ jobs th√†nh c√¥ng
  failedJobsHistoryLimit: 1 # Gi·ªØ 1 l·ªãch s·ª≠ jobs th·∫•t b·∫°i
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
            - name: cleanup-runner
              # S·ª≠ d·ª•ng Image t·ª´ etl.Dockerfile
              image: your-registry/genai-factory:etl-v1.0

              # HARDENING: Resource Limits (Cleanup c·∫ßn √≠t t√†i nguy√™n h∆°n)
              resources:
                limits:
                  cpu: "500m"
                  memory: "1Gi"
                requests:
                  cpu: "100m"
                  memory: "512Mi"

              envFrom:
                - secretRef:
                    name: genai-factory-secrets

              # ENTRYPOINT: Override ƒë·ªÉ ch·∫°y script d·ªçn d·∫πp
              args:
                [
                  "python3",
                  "scripts/cleanup_old_artifacts.py",
                  "--config-path",
                  "configs/governance/cleanup_config.yaml",
                ]
