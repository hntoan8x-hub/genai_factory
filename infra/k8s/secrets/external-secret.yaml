# infra/k8s/secrets/external-secret.yaml (MỚI - HARDENED)
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: genai-external-api-keys
spec:
  refreshInterval: "1h" # Tự động cập nhật bí mật mỗi giờ
  secretStoreRef:
    name: aws-secret-store # Tham chiếu đến một SecretStore đã được cấu hình
    kind: SecretStore
  target:
    name: genai-api-keys-sync # Tên của K8s Secret sẽ được tạo ra
    creationPolicy: Owner
  data:
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: /production/genai-factory/openai-key # Đường dẫn đến key trong AWS Secrets Manager
        property: api_key
